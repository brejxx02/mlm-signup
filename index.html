<!DOCTYPE html>
<html>
<head>
<title>BRAJESH NETWORK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px;}
.box{background:white;padding:20px;border-radius:10px;max-width:400px;margin:auto;margin-top:30px;}
input{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #aaa;}
button{width:100%;padding:10px;background:#007bff;color:white;font-size:16px;
border:none;border-radius:6px;margin-top:10px;}
button:hover{opacity:.8}
p{font-size:14px;}
a{color:#007bff;text-decoration:none;}
a:hover{text-decoration:underline;}
</style>
</head>

<body>

<div class="box" id="signupBox">
<h2>Create Account</h2>
<input id="name" placeholder="Full Name">
<input id="email" placeholder="Email">
<input id="mobile" placeholder="Mobile Number">
<input id="password" type="password" placeholder="Password">
<input id="sponsor" placeholder="Sponsor Code (required)">
<button onclick="signup()">Sign Up</button>
<p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<div class="box" id="loginBox" style="display:none;">
<h2>Login</h2>
<input id="emailLogin" placeholder="Email">
<input id="passwordLogin" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p>Don't have account? <a href="#" onclick="showSignup()">Create New</a></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, setDoc } 
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyATpuhDoP366I8e7XPcuphtfVdN0ucz69w",
    authDomain: "brajeshnetwork-f21c8.firebaseapp.com",
    projectId: "brajeshnetwork-f21c8",
    storageBucket: "brajeshnetwork-f21c8.firebasestorage.app",
    messagingSenderId: "1053315949596",
    appId: "1:1053315949596:web:7bbe45427cf6f29520abd9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ✅ Google Sheet Webhook URL
const sheetWebhook = "https://script.google.com/macros/s/YOUR_DEPLOY_ID/exec"; // <-- replace with your Apps Script URL

async function signup(){
 let name = document.getElementById("name").value.trim();
 let email = document.getElementById("email").value.trim();
 let mobile = document.getElementById("mobile").value.trim();
 let password = document.getElementById("password").value.trim();
 let sponsor = document.getElementById("sponsor").value.trim();

 if(!name || !email || !mobile || !password || !sponsor){
    alert("All fields required!");
    return;
 }

 try{
   const userCredential = await createUserWithEmailAndPassword(auth, email, password);
   const uid = userCredential.user.uid;

   // Save in Firestore
   await setDoc(doc(db,"users", uid),{
     name,email,mobile,sponsor,
     joined:false,
     wallet:0,
     level1:0,level2:0,level3:0,level4:0,
     referLink:"https://mlm-signup.netlify.app/?ref="+uid
   });

   // ✅ Save in Google Sheet
   fetch(sheetWebhook,{
     method:"POST",
     headers:{"Content-Type":"application/json"},
     body:JSON.stringify({uid,name,email,mobile,sponsor,txid:""})
   }).then(r=>r.json()).then(r=>console.log("Sheet save:",r)).catch(e=>console.warn("Sheet error:",e));

   alert("Signup Successful! Please login.");
   showLogin();
 }catch(e){
   alert(e.message);
 }
}

async function login(){
 let email = document.getElementById("emailLogin").value.trim();
 let password = document.getElementById("passwordLogin").value.trim();

 if(!email || !password){
    alert("Enter email & password!");
    return;
 }

 try{
   await signInWithEmailAndPassword(auth,email,password);
   alert("Login Successful!");
   window.location.href="dashboard.html"; // <-- dashboard page
 }catch(e){
   alert(e.message);
 }
}

function showLogin(){document.getElementById("signupBox").style.display="none";document.getElementById("loginBox").style.display="block";}
function showSignup(){document.getElementById("signupBox").style.display="block";document.getElementById("loginBox").style.display="none";}
</script>

</body>
</html>
